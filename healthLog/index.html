<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Log</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            overflow-x: hidden;
            width: 100%;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            min-height: 100vh;
            min-height: 100dvh;
            padding-bottom: 70px;
        }
        .container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            padding: max(20px, env(safe-area-inset-top)) max(20px, env(safe-area-inset-right)) 20px max(20px, env(safe-area-inset-left));
            overflow-x: hidden;
        }

        /* Tab Navigation */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            padding-bottom: max(8px, env(safe-area-inset-bottom));
            z-index: 1000;
        }
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 20px;
            border: none;
            background: none;
            color: #8e8e93;
            font-size: 11px;
            cursor: pointer;
            transition: color 0.2s;
        }
        .tab-item.active { color: #007aff; }
        .tab-item svg { width: 24px; height: 24px; }

        header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 24px;
        }
        header h1 { font-size: 1.5rem; flex: 1; font-weight: 600; }
        .back-btn {
            background: none;
            border: none;
            color: #007aff;
            font-size: 28px;
            cursor: pointer;
            padding: 5px;
        }

        /* View Toggle */
        .view-toggle {
            display: flex;
            background: #e8e8ed;
            border-radius: 8px;
            padding: 3px;
        }
        .view-toggle button {
            padding: 6px 12px;
            border: none;
            background: none;
            border-radius: 6px;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .view-toggle button.active {
            background: #fff;
            color: #007aff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .view-toggle button svg {
            width: 18px;
            height: 18px;
        }

        /* Calendar Styles */
        .calendar {
            background: #fff;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .calendar-header h2 {
            font-size: 18px;
            font-weight: 600;
        }
        .calendar-nav {
            display: flex;
            gap: 8px;
        }
        .calendar-nav button {
            width: 32px;
            height: 32px;
            border: none;
            background: #f0f0f0;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            color: #1d1d1f;
        }
        .calendar-nav button:active {
            background: #e0e0e0;
        }
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }
        .calendar-weekdays span {
            text-align: center;
            font-size: 12px;
            color: #888;
            font-weight: 500;
            padding: 4px;
        }
        .calendar-weekdays span:first-child { color: #ff3b30; }
        .calendar-weekdays span:last-child { color: #007aff; }
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 6px 2px;
            border: none;
            background: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            color: #1d1d1f;
            transition: background 0.15s;
            min-height: 50px;
        }
        .calendar-day:hover { background: #f5f5f7; }
        .calendar-day:active { background: #e8e8ed; }
        .calendar-day.other-month { color: #ccc; }
        .calendar-day.today {
            background: #007aff;
            color: #fff;
        }
        .calendar-day.today:hover { background: #0066d6; }
        .calendar-day.selected {
            background: #e8f4ff;
            color: #007aff;
            font-weight: 600;
        }
        .calendar-day.today.selected {
            background: #007aff;
            color: #fff;
        }
        .calendar-day.sunday { color: #ff3b30; }
        .calendar-day.saturday { color: #007aff; }
        .calendar-day.other-month.sunday,
        .calendar-day.other-month.saturday { color: #ccc; }
        .calendar-day .day-number {
            font-size: 14px;
            line-height: 1;
            margin-bottom: 4px;
        }
        .calendar-day .exercise-dots {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2px;
            max-width: 100%;
        }
        .exercise-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        /* Day Detail */
        .day-detail {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .day-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        .day-detail-header h3 {
            font-size: 16px;
            font-weight: 600;
        }
        .day-detail-close {
            background: none;
            border: none;
            font-size: 20px;
            color: #888;
            cursor: pointer;
            padding: 4px 8px;
        }
        .day-exercises {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .day-exercise-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f5f5f7;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.15s;
        }
        .day-exercise-item:active { background: #e8e8ed; }
        .day-exercise-item .color-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .day-exercise-item .exercise-info {
            flex: 1;
        }
        .day-exercise-item .exercise-name {
            font-weight: 500;
            font-size: 15px;
        }
        .day-exercise-item .exercise-sets {
            font-size: 13px;
            color: #888;
        }
        .day-exercise-item .arrow {
            color: #ccc;
            font-size: 18px;
        }
        .day-add-btn {
            width: 100%;
            padding: 14px;
            background: #007aff;
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
        }
        .day-add-btn:active { background: #0066d6; }

        /* Feed View (List View) */
        .feed-view {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .feed-day {
            background: #fff;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .feed-day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        .feed-day-date {
            font-size: 15px;
            font-weight: 600;
            color: #1d1d1f;
        }
        .feed-day-date.today {
            color: #007aff;
        }
        .feed-day-add {
            background: none;
            border: none;
            color: #007aff;
            font-size: 24px;
            cursor: pointer;
            padding: 0 4px;
        }
        .feed-exercises {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .feed-exercise {
            border-left: 3px solid #007aff;
            padding-left: 12px;
        }
        .feed-exercise-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .feed-exercise-name {
            font-weight: 600;
            font-size: 15px;
        }
        .feed-exercise-color {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .feed-sets {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .feed-set {
            background: #f5f5f7;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 13px;
            color: #1d1d1f;
        }
        .feed-set strong {
            font-weight: 600;
        }

        .add-form {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }
        .add-form input {
            flex: 1;
            padding: 14px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background: #fff;
            color: #1d1d1f;
            font-size: 16px;
        }
        .add-form input::placeholder { color: #999; }
        .add-form button {
            padding: 14px 22px;
            background: #007aff;
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
        }
        .add-form button:active { opacity: 0.8; }
        .color-btn {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            padding: 0;
            flex-shrink: 0;
        }

        .color-picker {
            background: #fff;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .color-presets {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        .color-preset {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
        }
        .color-preset.selected { border-color: #1d1d1f; }
        .color-custom {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }
        .color-custom input {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            padding: 0;
        }
        .color-custom span { color: #666; font-size: 14px; }

        .section-title {
            font-size: 13px;
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .list { display: flex; flex-direction: column; gap: 10px; }
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #fff;
            border-radius: 14px;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            transition: transform 0.1s;
            border-left: 4px solid #007aff;
        }
        .list-item:active { transform: scale(0.98); background: #f9f9f9; }
        .list-item h3 { font-size: 1.05rem; font-weight: 500; }
        .list-item .count { color: #888; font-size: 14px; margin-top: 4px; }
        .list-item .arrow { color: #ccc; font-size: 20px; }
        .list-item .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
        }
        .delete-btn {
            background: none;
            border: none;
            color: #ff3b30;
            font-size: 20px;
            cursor: pointer;
            padding: 8px 12px;
        }

        /* Detail page */
        .memo-row {
            margin-bottom: 12px;
        }
        .memo-row textarea, .memo-row input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background: #fff;
            color: #1d1d1f;
            font-size: 15px;
            font-family: inherit;
            resize: none;
        }
        .memo-row textarea::placeholder, .memo-row input::placeholder { color: #999; }

        .date-row {
            margin-bottom: 12px;
        }
        .date-row input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background: #fff;
            color: #1d1d1f;
            font-size: 16px;
        }
        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }
        .input-row input {
            flex: 1;
            padding: 14px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background: #fff;
            color: #1d1d1f;
            font-size: 17px;
            text-align: center;
        }
        .input-row input::placeholder { color: #999; }
        .add-set-btn {
            width: 100%;
            padding: 14px;
            background: #34c759;
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 24px;
        }
        .add-set-btn:active { background: #2da44e; }

        .history-title {
            color: #666;
            font-size: 13px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .set-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 14px 16px;
            background: #fff;
            border-radius: 12px;
            margin-bottom: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }
        .set-item .info { font-size: 16px; }
        .set-item strong { font-size: 18px; font-weight: 600; }
        .set-item .meta { color: #888; font-size: 13px; }
        .set-item .set-memo { color: #666; font-size: 13px; margin-top: 4px; font-style: italic; }

        .date-label {
            color: #666;
            font-size: 13px;
            font-weight: 500;
            margin: 20px 0 10px;
        }

        .empty { text-align: center; color: #999; padding: 50px 20px; font-size: 15px; }

        .editable-title { cursor: pointer; }
        .edit-btn {
            background: none;
            border: none;
            color: #007aff;
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
        }

        .title-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #007aff;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #1d1d1f;
        }

        .hidden { display: none; }

        /* Chart Page Styles */
        .chart-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background: #fff;
            color: #1d1d1f;
            font-size: 16px;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .chart-section {
            background: #fff;
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .chart-section h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .chart-container {
            height: 200px;
            position: relative;
            display: flex;
            align-items: flex-end;
            gap: 4px;
            padding-bottom: 30px;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 100%;
            width: 100%;
            gap: 6px;
        }
        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 40px;
        }
        .bar {
            width: 100%;
            background: linear-gradient(to top, #007aff, #5ac8fa);
            border-radius: 6px 6px 0 0;
            transition: height 0.3s ease;
            min-height: 4px;
        }
        .bar-label {
            font-size: 10px;
            color: #888;
            margin-top: 8px;
            text-align: center;
        }
        .bar-value {
            font-size: 10px;
            color: #1d1d1f;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .line-chart {
            position: relative;
            height: 100%;
            width: 100%;
        }
        .line-chart svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }
        .line-path {
            fill: none;
            stroke: #007aff;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .line-area {
            fill: url(#lineGradient);
        }
        .line-dot {
            fill: #007aff;
        }
        .line-labels {
            display: flex;
            justify-content: space-between;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
        }
        .line-label {
            font-size: 10px;
            color: #888;
        }

        /* Timer Page Styles */
        .timer-display {
            text-align: center;
            padding: 40px 20px;
        }
        .timer-time {
            font-size: 80px;
            font-weight: 200;
            color: #1d1d1f;
            font-variant-numeric: tabular-nums;
            line-height: 1;
            margin-bottom: 10px;
        }
        .timer-status {
            font-size: 16px;
            color: #888;
            margin-bottom: 30px;
        }

        .timer-presets {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .preset-btn {
            padding: 16px 10px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
        }
        .preset-btn.active {
            border-color: #007aff;
            background: #007aff;
            color: #fff;
        }
        .preset-btn:active { transform: scale(0.95); }

        .timer-custom {
            display: flex;
            gap: 10px;
            margin-bottom: 24px;
        }
        .timer-custom input {
            flex: 1;
            padding: 14px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background: #fff;
            font-size: 16px;
            text-align: center;
        }
        .timer-custom button {
            padding: 14px 20px;
            background: #007aff;
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
        }

        .timer-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        .timer-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .timer-btn:active { transform: scale(0.95); }
        .timer-btn.start {
            background: #34c759;
            color: #fff;
        }
        .timer-btn.pause {
            background: #ff9500;
            color: #fff;
        }
        .timer-btn.reset {
            background: #e0e0e0;
            color: #1d1d1f;
        }

        .timer-progress {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            position: relative;
        }
        .timer-progress svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }
        .timer-progress-bg {
            fill: none;
            stroke: #e0e0e0;
            stroke-width: 8;
        }
        .timer-progress-bar {
            fill: none;
            stroke: #007aff;
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.1s linear;
        }
        .timer-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .exercise-select-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }
        .exercise-select-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: #f5f5f7;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.15s;
        }
        .exercise-select-item:active { background: #e8e8ed; }
        .exercise-select-item .color-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .exercise-select-item span { font-size: 16px; font-weight: 500; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tab: Record (Main) -->
        <div id="recordTab">
            <!-- Main Page -->
            <div id="mainPage">
                <header>
                    <h1>Health Log</h1>
                    <div class="view-toggle">
                        <button id="calendarViewBtn" class="active" title="달력 뷰">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                        </button>
                        <button id="listViewBtn" title="리스트 뷰">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"/>
                                <line x1="8" y1="12" x2="21" y2="12"/>
                                <line x1="8" y1="18" x2="21" y2="18"/>
                                <line x1="3" y1="6" x2="3.01" y2="6"/>
                                <line x1="3" y1="12" x2="3.01" y2="12"/>
                                <line x1="3" y1="18" x2="3.01" y2="18"/>
                            </svg>
                        </button>
                    </div>
                </header>

                <!-- Calendar View -->
                <div id="calendarView">
                    <div class="calendar">
                        <div class="calendar-header">
                            <h2 id="calendarTitle">2024년 1월</h2>
                            <div class="calendar-nav">
                                <button id="prevMonth">‹</button>
                                <button id="nextMonth">›</button>
                            </div>
                        </div>
                        <div class="calendar-weekdays">
                            <span>일</span><span>월</span><span>화</span><span>수</span><span>목</span><span>금</span><span>토</span>
                        </div>
                        <div class="calendar-days" id="calendarDays"></div>
                    </div>

                    <!-- Day Detail -->
                    <div class="day-detail hidden" id="dayDetail">
                        <div class="day-detail-header">
                            <h3 id="dayDetailTitle">1월 1일 기록</h3>
                            <button class="day-detail-close" id="closeDayDetail">×</button>
                        </div>
                        <div class="day-exercises" id="dayExercises"></div>
                        <button class="day-add-btn" id="dayAddBtn">+ 이 날짜에 기록 추가</button>
                    </div>

                    <!-- Exercise Select -->
                    <div class="day-detail hidden" id="exerciseSelectPanel">
                        <div class="day-detail-header">
                            <h3 id="exerciseSelectTitle">운동 선택</h3>
                            <button class="day-detail-close" id="closeExerciseSelect">×</button>
                        </div>
                        <div class="exercise-select-list" id="exerciseSelectList"></div>
                    </div>
                </div>

                <!-- List/Feed View -->
                <div id="listView" class="hidden">
                    <div class="feed-view" id="feedView"></div>
                </div>

                <!-- Add Exercise Form -->
                <div class="section-title">운동 목록</div>
                <div class="add-form">
                    <button class="color-btn" id="colorBtn" style="background:#007aff"></button>
                    <input type="text" id="exerciseName" placeholder="운동 이름">
                    <button id="addExerciseBtn">+</button>
                </div>
                <div class="color-picker hidden" id="colorPicker">
                    <div class="color-presets" id="colorPresets"></div>
                    <div class="color-custom">
                        <input type="color" id="customColor" value="#007aff">
                        <span>커스텀</span>
                    </div>
                </div>
                <div class="list" id="exerciseList"></div>
            </div>

            <!-- Detail Page: Sets -->
            <div id="detailPage" class="hidden">
                <header>
                    <button class="back-btn" id="backBtn">←</button>
                    <h1 id="detailTitle" class="editable-title">운동명</h1>
                    <button class="edit-btn" id="editTitleBtn">✎</button>
                </header>
                <div class="memo-row">
                    <textarea id="exerciseMemo" placeholder="운동 메모 (선택)" rows="2"></textarea>
                </div>
                <div class="date-row">
                    <input type="date" id="dateInput">
                </div>
                <div class="input-row">
                    <input type="number" id="weightInput" placeholder="kg" inputmode="decimal">
                    <input type="number" id="repsInput" placeholder="reps" inputmode="numeric">
                </div>
                <div class="memo-row">
                    <input type="text" id="setMemo" placeholder="세트 메모 (선택)">
                </div>
                <button class="add-set-btn" id="addSetBtn">Add Set</button>
                <div class="history-title">기록</div>
                <div id="setList"></div>
            </div>
        </div>

        <!-- Tab: Chart -->
        <div id="chartTab" class="hidden">
            <header>
                <h1>차트</h1>
            </header>
            <select class="chart-select" id="chartExerciseSelect">
                <option value="">운동을 선택하세요</option>
            </select>
            <div id="chartContent" class="hidden">
                <div class="chart-section">
                    <h3>무게 변화 추이</h3>
                    <div class="chart-container">
                        <div class="line-chart" id="weightChart"></div>
                    </div>
                </div>
                <div class="chart-section">
                    <h3>일별 볼륨 (kg × reps)</h3>
                    <div class="chart-container">
                        <div class="bar-chart" id="volumeChart"></div>
                    </div>
                </div>
            </div>
            <div id="chartEmpty" class="empty">운동을 선택하면 차트가 표시됩니다</div>
        </div>

        <!-- Tab: Timer -->
        <div id="timerTab" class="hidden">
            <header>
                <h1>휴식 타이머</h1>
            </header>
            <div class="timer-display">
                <div class="timer-progress">
                    <svg viewBox="0 0 100 100">
                        <circle class="timer-progress-bg" cx="50" cy="50" r="45"/>
                        <circle class="timer-progress-bar" id="timerProgressBar" cx="50" cy="50" r="45"
                            stroke-dasharray="283" stroke-dashoffset="0"/>
                    </svg>
                    <div class="timer-progress-text">
                        <div class="timer-time" id="timerDisplay">1:00</div>
                        <div class="timer-status" id="timerStatus">준비</div>
                    </div>
                </div>
            </div>
            <div class="timer-presets">
                <button class="preset-btn" data-time="30">30초</button>
                <button class="preset-btn active" data-time="60">1분</button>
                <button class="preset-btn" data-time="90">1분 30초</button>
                <button class="preset-btn" data-time="120">2분</button>
            </div>
            <div class="timer-custom">
                <input type="number" id="customTime" placeholder="초 입력" inputmode="numeric">
                <button id="setCustomTime">설정</button>
            </div>
            <div class="timer-controls">
                <button class="timer-btn reset" id="timerReset">리셋</button>
                <button class="timer-btn start" id="timerToggle">시작</button>
            </div>
        </div>
    </div>

    <!-- Tab Bar -->
    <nav class="tab-bar">
        <button class="tab-item active" data-tab="record">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <span>기록</span>
        </button>
        <button class="tab-item" data-tab="chart">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 20V10M12 20V4M6 20v-6"/>
            </svg>
            <span>차트</span>
        </button>
        <button class="tab-item" data-tab="timer">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
            </svg>
            <span>타이머</span>
        </button>
    </nav>

    <script>
        // ==================== DATA ====================
        const KEY = 'healthLog';
        const today = new Date().toISOString().split('T')[0];
        const PRESET_COLORS = [
            '#ff6b6b', '#ff8787', '#f06595', '#cc5de8', '#845ef7',
            '#5c7cfa', '#339af0', '#22b8cf', '#20c997', '#51cf66',
            '#94d82d', '#fcc419', '#ff922b', '#ff6b6b', '#868e96'
        ];

        let stored = JSON.parse(localStorage.getItem(KEY) || '{}');
        let data = (stored.exercises && stored.records)
            ? { ...stored, colors: stored.colors || {}, memos: stored.memos || {} }
            : { exercises: [], colors: {}, memos: {}, records: {} };
        let currentExercise = null;
        let selectedColor = '#007aff';
        let selectedDate = today;
        let calendarYear = new Date().getFullYear();
        let calendarMonth = new Date().getMonth();
        let currentViewMode = 'calendar'; // 'calendar' or 'list'

        function save() {
            localStorage.setItem(KEY, JSON.stringify(data));
        }

        // ==================== TAB NAVIGATION ====================
        const tabs = {
            record: document.getElementById('recordTab'),
            chart: document.getElementById('chartTab'),
            timer: document.getElementById('timerTab')
        };
        const tabButtons = document.querySelectorAll('.tab-item');

        function switchTab(tabName) {
            Object.values(tabs).forEach(t => t.classList.add('hidden'));
            tabs[tabName].classList.remove('hidden');
            tabButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            if (tabName === 'chart') {
                updateChartSelect();
            }
            if (tabName === 'record') {
                if (currentViewMode === 'calendar') {
                    renderCalendar();
                } else {
                    renderFeedView();
                }
            }
        }

        tabButtons.forEach(btn => {
            btn.addEventListener('click', () => switchTab(btn.dataset.tab));
        });

        // ==================== VIEW MODE TOGGLE ====================
        const calendarViewBtn = document.getElementById('calendarViewBtn');
        const listViewBtn = document.getElementById('listViewBtn');
        const calendarView = document.getElementById('calendarView');
        const listView = document.getElementById('listView');

        function setViewMode(mode) {
            currentViewMode = mode;
            calendarViewBtn.classList.toggle('active', mode === 'calendar');
            listViewBtn.classList.toggle('active', mode === 'list');
            calendarView.classList.toggle('hidden', mode !== 'calendar');
            listView.classList.toggle('hidden', mode !== 'list');

            if (mode === 'calendar') {
                renderCalendar();
            } else {
                renderFeedView();
            }
        }

        calendarViewBtn.addEventListener('click', () => setViewMode('calendar'));
        listViewBtn.addEventListener('click', () => setViewMode('list'));

        // ==================== FEED VIEW ====================
        const feedView = document.getElementById('feedView');

        function getAllRecordDates() {
            const dates = new Set();
            for (const exercise of data.exercises) {
                const records = data.records[exercise] || [];
                records.forEach(r => dates.add(r.d));
            }
            return Array.from(dates).sort().reverse();
        }

        function getExercisesForDate(dateStr) {
            const result = [];
            for (const exercise of data.exercises) {
                const records = data.records[exercise] || [];
                const dayRecords = records.filter(r => r.d === dateStr);
                if (dayRecords.length > 0) {
                    result.push({
                        name: exercise,
                        color: data.colors[exercise] || '#007aff',
                        sets: dayRecords.length,
                        records: dayRecords
                    });
                }
            }
            return result;
        }

        function formatDateKorean(dateStr) {
            const d = new Date(dateStr);
            const days = ['일', '월', '화', '수', '목', '금', '토'];
            const month = d.getMonth() + 1;
            const date = d.getDate();
            const day = days[d.getDay()];
            return `${month}월 ${date}일 (${day})`;
        }

        function renderFeedView() {
            const dates = getAllRecordDates();

            if (dates.length === 0) {
                feedView.innerHTML = '<div class="empty">기록이 없습니다</div>';
                return;
            }

            feedView.innerHTML = dates.map(dateStr => {
                const exercises = getExercisesForDate(dateStr);
                const isToday = dateStr === today;

                return `
                    <div class="feed-day">
                        <div class="feed-day-header">
                            <span class="feed-day-date ${isToday ? 'today' : ''}">${isToday ? '오늘' : formatDateKorean(dateStr)}</span>
                            <button class="feed-day-add" data-date="${dateStr}">+</button>
                        </div>
                        <div class="feed-exercises">
                            ${exercises.map(ex => `
                                <div class="feed-exercise" style="border-left-color: ${ex.color}" data-exercise="${ex.name}" data-date="${dateStr}">
                                    <div class="feed-exercise-header">
                                        <span class="feed-exercise-color" style="background: ${ex.color}"></span>
                                        <span class="feed-exercise-name">${ex.name}</span>
                                    </div>
                                    <div class="feed-sets">
                                        ${ex.records.map((r, i) => `
                                            <span class="feed-set"><strong>${r.w}kg</strong> × ${r.r}</span>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        feedView.addEventListener('click', e => {
            const addBtn = e.target.closest('.feed-day-add');
            if (addBtn) {
                selectedDate = addBtn.dataset.date;
                showExerciseSelect();
                return;
            }

            const exerciseEl = e.target.closest('.feed-exercise');
            if (exerciseEl) {
                showDetail(exerciseEl.dataset.exercise, exerciseEl.dataset.date);
            }
        });

        // ==================== CALENDAR ====================
        const calendarTitle = document.getElementById('calendarTitle');
        const calendarDays = document.getElementById('calendarDays');
        const dayDetail = document.getElementById('dayDetail');
        const dayDetailTitle = document.getElementById('dayDetailTitle');
        const dayExercises = document.getElementById('dayExercises');
        const exerciseSelectPanel = document.getElementById('exerciseSelectPanel');
        const exerciseSelectList = document.getElementById('exerciseSelectList');
        const exerciseSelectTitle = document.getElementById('exerciseSelectTitle');

        function getExerciseColorsForDate(dateStr) {
            const colors = [];
            for (const exercise of data.exercises) {
                const records = data.records[exercise] || [];
                if (records.some(r => r.d === dateStr)) {
                    colors.push(data.colors[exercise] || '#007aff');
                }
            }
            return colors.slice(0, 4);
        }

        function renderCalendar() {
            calendarTitle.textContent = `${calendarYear}년 ${calendarMonth + 1}월`;

            const firstDay = new Date(calendarYear, calendarMonth, 1);
            const lastDay = new Date(calendarYear, calendarMonth + 1, 0);
            const startDay = firstDay.getDay();
            const totalDays = lastDay.getDate();
            const prevLastDay = new Date(calendarYear, calendarMonth, 0).getDate();

            let html = '';

            for (let i = startDay - 1; i >= 0; i--) {
                const day = prevLastDay - i;
                const date = new Date(calendarYear, calendarMonth - 1, day);
                const dateStr = date.toISOString().split('T')[0];
                const colors = getExerciseColorsForDate(dateStr);
                const dayOfWeek = (startDay - 1 - i) % 7;
                let classes = 'calendar-day other-month';
                if (dayOfWeek === 0) classes += ' sunday';
                if (dayOfWeek === 6) classes += ' saturday';

                html += `
                    <button class="${classes}" data-date="${dateStr}">
                        <span class="day-number">${day}</span>
                        <div class="exercise-dots">
                            ${colors.map(c => `<span class="exercise-dot" style="background:${c}"></span>`).join('')}
                        </div>
                    </button>
                `;
            }

            for (let day = 1; day <= totalDays; day++) {
                const date = new Date(calendarYear, calendarMonth, day);
                const dateStr = date.toISOString().split('T')[0];
                const colors = getExerciseColorsForDate(dateStr);
                const dayOfWeek = date.getDay();

                let classes = 'calendar-day';
                if (dateStr === today) classes += ' today';
                if (dateStr === selectedDate) classes += ' selected';
                if (dayOfWeek === 0) classes += ' sunday';
                if (dayOfWeek === 6) classes += ' saturday';

                html += `
                    <button class="${classes}" data-date="${dateStr}">
                        <span class="day-number">${day}</span>
                        <div class="exercise-dots">
                            ${colors.map(c => `<span class="exercise-dot" style="background:${c}"></span>`).join('')}
                        </div>
                    </button>
                `;
            }

            const remaining = 42 - (startDay + totalDays);
            for (let day = 1; day <= remaining; day++) {
                const date = new Date(calendarYear, calendarMonth + 1, day);
                const dateStr = date.toISOString().split('T')[0];
                const colors = getExerciseColorsForDate(dateStr);
                const dayOfWeek = (startDay + totalDays + day - 1) % 7;
                let classes = 'calendar-day other-month';
                if (dayOfWeek === 0) classes += ' sunday';
                if (dayOfWeek === 6) classes += ' saturday';

                html += `
                    <button class="${classes}" data-date="${dateStr}">
                        <span class="day-number">${day}</span>
                        <div class="exercise-dots">
                            ${colors.map(c => `<span class="exercise-dot" style="background:${c}"></span>`).join('')}
                        </div>
                    </button>
                `;
            }

            calendarDays.innerHTML = html;
        }

        function showDayDetail(dateStr) {
            selectedDate = dateStr;
            const date = new Date(dateStr);
            const month = date.getMonth() + 1;
            const day = date.getDate();

            dayDetailTitle.textContent = dateStr === today ? '오늘 기록' : `${month}월 ${day}일 기록`;

            const exercises = getExercisesForDate(dateStr);

            if (exercises.length === 0) {
                dayExercises.innerHTML = '<div class="empty" style="padding:20px">기록이 없습니다</div>';
            } else {
                dayExercises.innerHTML = exercises.map(ex => `
                    <div class="day-exercise-item" data-exercise="${ex.name}">
                        <span class="color-dot" style="background:${ex.color}"></span>
                        <div class="exercise-info">
                            <div class="exercise-name">${ex.name}</div>
                            <div class="exercise-sets">${ex.sets}세트</div>
                        </div>
                        <span class="arrow">›</span>
                    </div>
                `).join('');
            }

            dayDetail.classList.remove('hidden');
            exerciseSelectPanel.classList.add('hidden');
            renderCalendar();
        }

        function showExerciseSelect() {
            const date = new Date(selectedDate);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            exerciseSelectTitle.textContent = selectedDate === today ? '오늘 기록 추가' : `${month}월 ${day}일 기록 추가`;

            if (data.exercises.length === 0) {
                exerciseSelectList.innerHTML = '<div class="empty" style="padding:20px">먼저 운동을 추가하세요</div>';
            } else {
                exerciseSelectList.innerHTML = data.exercises.map(name => `
                    <div class="exercise-select-item" data-exercise="${name}">
                        <span class="color-dot" style="background:${data.colors[name] || '#007aff'}"></span>
                        <span>${name}</span>
                    </div>
                `).join('');
            }

            exerciseSelectPanel.classList.remove('hidden');
            dayDetail.classList.add('hidden');
        }

        document.getElementById('prevMonth').addEventListener('click', () => {
            calendarMonth--;
            if (calendarMonth < 0) {
                calendarMonth = 11;
                calendarYear--;
            }
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            calendarMonth++;
            if (calendarMonth > 11) {
                calendarMonth = 0;
                calendarYear++;
            }
            renderCalendar();
        });

        calendarDays.addEventListener('click', e => {
            const dayBtn = e.target.closest('.calendar-day');
            if (dayBtn) {
                showDayDetail(dayBtn.dataset.date);
            }
        });

        document.getElementById('closeDayDetail').addEventListener('click', () => {
            dayDetail.classList.add('hidden');
            selectedDate = today;
            renderCalendar();
        });

        document.getElementById('closeExerciseSelect').addEventListener('click', () => {
            exerciseSelectPanel.classList.add('hidden');
            if (currentViewMode === 'calendar') {
                showDayDetail(selectedDate);
            }
        });

        document.getElementById('dayAddBtn').addEventListener('click', showExerciseSelect);

        dayExercises.addEventListener('click', e => {
            const item = e.target.closest('.day-exercise-item');
            if (item) {
                showDetail(item.dataset.exercise, selectedDate);
            }
        });

        exerciseSelectList.addEventListener('click', e => {
            const item = e.target.closest('.exercise-select-item');
            if (item) {
                showDetail(item.dataset.exercise, selectedDate);
            }
        });

        // ==================== RECORD TAB ====================
        const mainPage = document.getElementById('mainPage');
        const detailPage = document.getElementById('detailPage');
        const exerciseList = document.getElementById('exerciseList');
        const exerciseNameInput = document.getElementById('exerciseName');
        const detailTitle = document.getElementById('detailTitle');
        const setList = document.getElementById('setList');
        const dateInput = document.getElementById('dateInput');
        const weightInput = document.getElementById('weightInput');
        const repsInput = document.getElementById('repsInput');
        const exerciseMemo = document.getElementById('exerciseMemo');
        const setMemoInput = document.getElementById('setMemo');
        const colorBtn = document.getElementById('colorBtn');
        const colorPicker = document.getElementById('colorPicker');
        const colorPresets = document.getElementById('colorPresets');
        const customColor = document.getElementById('customColor');

        colorPresets.innerHTML = PRESET_COLORS.map(c =>
            `<div class="color-preset" data-color="${c}" style="background:${c}"></div>`
        ).join('');

        function selectColorFn(color) {
            selectedColor = color;
            colorBtn.style.background = color;
            customColor.value = color;
            document.querySelectorAll('.color-preset').forEach(el => {
                el.classList.toggle('selected', el.dataset.color === color);
            });
        }

        colorBtn.addEventListener('click', () => {
            colorPicker.classList.toggle('hidden');
        });

        colorPresets.addEventListener('click', e => {
            if (e.target.classList.contains('color-preset')) {
                selectColorFn(e.target.dataset.color);
                colorPicker.classList.add('hidden');
            }
        });

        customColor.addEventListener('input', e => {
            selectColorFn(e.target.value);
        });

        customColor.addEventListener('change', () => {
            colorPicker.classList.add('hidden');
        });

        function renderMain() {
            if (data.exercises.length === 0) {
                exerciseList.innerHTML = '<div class="empty">운동을 추가하세요</div>';
                return;
            }

            exerciseList.innerHTML = data.exercises.map(name => {
                const records = data.records[name] || [];
                const todayCount = records.filter(r => r.d === today).length;
                const color = data.colors[name] || '#007aff';
                return `
                <div class="list-item" data-name="${name}" style="border-left-color:${color}">
                    <div style="display:flex;align-items:center">
                        <div class="color-dot" style="background:${color}"></div>
                        <div>
                            <h3>${name}</h3>
                            <span class="count">오늘 ${todayCount}세트</span>
                        </div>
                    </div>
                    <div>
                        <button class="delete-btn" data-name="${name}">&times;</button>
                        <span class="arrow">›</span>
                    </div>
                </div>
                `;
            }).join('');
        }

        function renderDetail(filterDate = null) {
            const records = data.records[currentExercise] || [];

            const byDate = {};
            records.forEach((r, i) => {
                if (filterDate && r.d !== filterDate) return;
                if (!byDate[r.d]) byDate[r.d] = [];
                byDate[r.d].push({ ...r, idx: i });
            });

            const dates = Object.keys(byDate).sort().reverse();

            if (dates.length === 0) {
                setList.innerHTML = '<div class="empty">기록이 없습니다</div>';
                return;
            }

            setList.innerHTML = dates.map(date => {
                const sets = byDate[date];
                const dateLabel = date === today ? '오늘' : date;
                return `
                    <div class="date-label">${dateLabel}</div>
                    ${sets.map((s, i) => `
                        <div class="set-item">
                            <div>
                                <span class="info"><strong>${s.w}kg</strong> x ${s.r}reps</span>
                                ${s.m ? `<div class="set-memo">${s.m}</div>` : ''}
                            </div>
                            <div>
                                <span class="meta">Set ${i + 1}</span>
                                <button class="delete-btn" data-idx="${s.idx}">&times;</button>
                            </div>
                        </div>
                    `).join('')}
                `;
            }).join('');
        }

        function showMain() {
            mainPage.classList.remove('hidden');
            detailPage.classList.add('hidden');
            currentExercise = null;
            renderMain();
            if (currentViewMode === 'calendar') {
                renderCalendar();
            } else {
                renderFeedView();
            }
        }

        function showDetail(name, date = null) {
            currentExercise = name;
            detailTitle.textContent = name;
            mainPage.classList.add('hidden');
            detailPage.classList.remove('hidden');
            dayDetail.classList.add('hidden');
            exerciseSelectPanel.classList.add('hidden');
            exerciseMemo.value = data.memos[name] || '';
            dateInput.value = date || selectedDate || today;
            weightInput.value = '';
            repsInput.value = '';
            setMemoInput.value = '';
            renderDetail(date);
        }

        exerciseMemo.addEventListener('blur', () => {
            if (currentExercise) {
                data.memos[currentExercise] = exerciseMemo.value.trim();
                save();
            }
        });

        function addExercise() {
            const name = exerciseNameInput.value.trim();
            if (!name || data.exercises.includes(name)) return;

            data.exercises.push(name);
            data.colors[name] = selectedColor;
            data.records[name] = [];
            save();
            renderMain();
            if (currentViewMode === 'calendar') {
                renderCalendar();
            } else {
                renderFeedView();
            }
            exerciseNameInput.value = '';
            colorPicker.classList.add('hidden');
        }

        document.getElementById('addExerciseBtn').addEventListener('click', addExercise);
        exerciseNameInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') addExercise();
        });

        exerciseList.addEventListener('click', e => {
            if (e.target.classList.contains('delete-btn')) {
                const name = e.target.dataset.name;
                data.exercises = data.exercises.filter(n => n !== name);
                delete data.colors[name];
                delete data.memos[name];
                delete data.records[name];
                save();
                renderMain();
                if (currentViewMode === 'calendar') {
                    renderCalendar();
                } else {
                    renderFeedView();
                }
                return;
            }

            const item = e.target.closest('.list-item');
            if (item) {
                showDetail(item.dataset.name);
            }
        });

        document.getElementById('backBtn').addEventListener('click', showMain);

        const editTitleBtn = document.getElementById('editTitleBtn');

        function startEditTitle() {
            const currentName = currentExercise;
            const header = detailTitle.parentElement;

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'title-input';
            input.value = currentName;

            detailTitle.style.display = 'none';
            editTitleBtn.style.display = 'none';
            header.insertBefore(input, detailTitle);
            input.focus();
            input.select();

            function finishEdit() {
                const newName = input.value.trim();
                input.remove();
                detailTitle.style.display = '';
                editTitleBtn.style.display = '';

                if (!newName || newName === currentName) return;

                if (data.exercises.includes(newName)) {
                    if (confirm(`"${newName}" 이미 존재합니다. 합칠까요?`)) {
                        data.records[newName] = [...data.records[newName], ...data.records[currentName]];
                        data.exercises = data.exercises.filter(n => n !== currentName);
                        delete data.colors[currentName];
                        delete data.memos[currentName];
                        delete data.records[currentName];
                        currentExercise = newName;
                        detailTitle.textContent = newName;
                        exerciseMemo.value = data.memos[newName] || '';
                        save();
                        renderDetail();
                    }
                } else {
                    const idx = data.exercises.indexOf(currentName);
                    data.exercises[idx] = newName;
                    data.colors[newName] = data.colors[currentName];
                    delete data.colors[currentName];
                    data.memos[newName] = data.memos[currentName];
                    delete data.memos[currentName];
                    data.records[newName] = data.records[currentName];
                    delete data.records[currentName];
                    currentExercise = newName;
                    detailTitle.textContent = newName;
                    save();
                }
            }

            input.addEventListener('blur', finishEdit);
            input.addEventListener('keydown', e => {
                if (e.key === 'Enter') input.blur();
                if (e.key === 'Escape') {
                    input.value = currentName;
                    input.blur();
                }
            });
        }

        editTitleBtn.addEventListener('click', startEditTitle);
        detailTitle.addEventListener('click', startEditTitle);

        function addSet() {
            const d = dateInput.value || today;
            const w = parseFloat(weightInput.value) || 0;
            const r = parseInt(repsInput.value);
            const m = setMemoInput.value.trim();
            if (!r) return;

            const record = { d, w, r };
            if (m) record.m = m;
            data.records[currentExercise].push(record);
            save();
            renderDetail();
            if (currentViewMode === 'calendar') {
                renderCalendar();
            } else {
                renderFeedView();
            }
            weightInput.value = '';
            repsInput.value = '';
            setMemoInput.value = '';
            weightInput.focus();
        }

        document.getElementById('addSetBtn').addEventListener('click', addSet);
        [weightInput, repsInput].forEach(el => {
            el.addEventListener('keydown', e => {
                if (e.key === 'Enter') addSet();
            });
        });

        setList.addEventListener('click', e => {
            if (e.target.classList.contains('delete-btn')) {
                const idx = parseInt(e.target.dataset.idx);
                data.records[currentExercise].splice(idx, 1);
                save();
                renderDetail();
                if (currentViewMode === 'calendar') {
                    renderCalendar();
                } else {
                    renderFeedView();
                }
            }
        });

        // ==================== CHART TAB ====================
        const chartSelect = document.getElementById('chartExerciseSelect');
        const chartContent = document.getElementById('chartContent');
        const chartEmpty = document.getElementById('chartEmpty');
        const weightChart = document.getElementById('weightChart');
        const volumeChart = document.getElementById('volumeChart');

        function updateChartSelect() {
            chartSelect.innerHTML = '<option value="">운동을 선택하세요</option>' +
                data.exercises.map(name => `<option value="${name}">${name}</option>`).join('');
        }

        chartSelect.addEventListener('change', () => {
            const exercise = chartSelect.value;
            if (!exercise) {
                chartContent.classList.add('hidden');
                chartEmpty.classList.remove('hidden');
                return;
            }
            chartContent.classList.remove('hidden');
            chartEmpty.classList.add('hidden');
            renderCharts(exercise);
        });

        function renderCharts(exercise) {
            const records = data.records[exercise] || [];
            if (records.length === 0) {
                chartContent.classList.add('hidden');
                chartEmpty.textContent = '기록이 없습니다';
                chartEmpty.classList.remove('hidden');
                return;
            }

            const byDate = {};
            records.forEach(r => {
                if (!byDate[r.d]) byDate[r.d] = [];
                byDate[r.d].push(r);
            });

            const dates = Object.keys(byDate).sort().slice(-14);

            const chartData = dates.map(date => {
                const dayRecords = byDate[date];
                const maxWeight = Math.max(...dayRecords.map(r => r.w));
                const totalVolume = dayRecords.reduce((sum, r) => sum + (r.w * r.r), 0);
                return { date, maxWeight, totalVolume };
            });

            renderWeightChart(chartData);
            renderVolumeChart(chartData);
        }

        function formatDateShort(dateStr) {
            const d = new Date(dateStr);
            return `${d.getMonth() + 1}/${d.getDate()}`;
        }

        function renderWeightChart(chartData) {
            if (chartData.length === 0) {
                weightChart.innerHTML = '<div class="empty">데이터 없음</div>';
                return;
            }

            const maxWeight = Math.max(...chartData.map(d => d.maxWeight));
            const minWeight = Math.min(...chartData.map(d => d.maxWeight));
            const range = maxWeight - minWeight || 1;

            const width = 100;
            const height = 100;
            const padding = 10;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;

            const points = chartData.map((d, i) => {
                const x = padding + (i / (chartData.length - 1 || 1)) * chartWidth;
                const y = padding + chartHeight - ((d.maxWeight - minWeight) / range) * chartHeight;
                return { x, y, data: d };
            });

            const pathD = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ');
            const areaD = pathD + ` L ${points[points.length - 1].x} ${height - padding} L ${padding} ${height - padding} Z`;

            weightChart.innerHTML = `
                <svg viewBox="0 0 ${width} ${height}" preserveAspectRatio="none">
                    <defs>
                        <linearGradient id="lineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#007aff;stop-opacity:0.3"/>
                            <stop offset="100%" style="stop-color:#007aff;stop-opacity:0"/>
                        </linearGradient>
                    </defs>
                    <path class="line-area" d="${areaD}"/>
                    <path class="line-path" d="${pathD}"/>
                    ${points.map(p => `<circle class="line-dot" cx="${p.x}" cy="${p.y}" r="3"/>`).join('')}
                </svg>
                <div class="line-labels">
                    ${chartData.filter((_, i) => i === 0 || i === chartData.length - 1).map(d =>
                        `<span class="line-label">${formatDateShort(d.date)}<br>${d.maxWeight}kg</span>`
                    ).join('')}
                </div>
            `;
        }

        function renderVolumeChart(chartData) {
            if (chartData.length === 0) {
                volumeChart.innerHTML = '<div class="empty">데이터 없음</div>';
                return;
            }

            const maxVolume = Math.max(...chartData.map(d => d.totalVolume));

            volumeChart.innerHTML = chartData.map(d => {
                const heightPercent = (d.totalVolume / maxVolume) * 100;
                return `
                    <div class="bar-item">
                        <span class="bar-value">${d.totalVolume >= 1000 ? (d.totalVolume / 1000).toFixed(1) + 'k' : d.totalVolume}</span>
                        <div class="bar" style="height: ${heightPercent}%"></div>
                        <span class="bar-label">${formatDateShort(d.date)}</span>
                    </div>
                `;
            }).join('');
        }

        // ==================== TIMER TAB ====================
        let timerDuration = 60;
        let timerRemaining = 60;
        let timerInterval = null;
        let timerRunning = false;

        const timerDisplay = document.getElementById('timerDisplay');
        const timerStatus = document.getElementById('timerStatus');
        const timerToggle = document.getElementById('timerToggle');
        const timerReset = document.getElementById('timerReset');
        const timerProgressBar = document.getElementById('timerProgressBar');
        const presetBtns = document.querySelectorAll('.preset-btn');
        const customTimeInput = document.getElementById('customTime');
        const setCustomTimeBtn = document.getElementById('setCustomTime');

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            timerDisplay.textContent = formatTime(timerRemaining);
            const progress = timerRemaining / timerDuration;
            const circumference = 283;
            timerProgressBar.style.strokeDashoffset = circumference * (1 - progress);
        }

        function setTimerFn(seconds) {
            timerDuration = seconds;
            timerRemaining = seconds;
            timerRunning = false;
            clearInterval(timerInterval);
            timerToggle.textContent = '시작';
            timerToggle.classList.remove('pause');
            timerToggle.classList.add('start');
            timerStatus.textContent = '준비';
            updateTimerDisplay();
        }

        function startTimer() {
            if (timerRemaining <= 0) {
                timerRemaining = timerDuration;
            }
            timerRunning = true;
            timerToggle.textContent = '일시정지';
            timerToggle.classList.remove('start');
            timerToggle.classList.add('pause');
            timerStatus.textContent = '진행 중';

            timerInterval = setInterval(() => {
                timerRemaining--;
                updateTimerDisplay();

                if (timerRemaining <= 0) {
                    clearInterval(timerInterval);
                    timerRunning = false;
                    timerToggle.textContent = '시작';
                    timerToggle.classList.remove('pause');
                    timerToggle.classList.add('start');
                    timerStatus.textContent = '완료!';

                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    }

                    try {
                        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioCtx.createOscillator();
                        const gainNode = audioCtx.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(audioCtx.destination);
                        oscillator.frequency.value = 800;
                        oscillator.type = 'sine';
                        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + 0.5);
                    } catch (e) {}
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
            timerToggle.textContent = '계속';
            timerToggle.classList.remove('pause');
            timerToggle.classList.add('start');
            timerStatus.textContent = '일시정지';
        }

        timerToggle.addEventListener('click', () => {
            if (timerRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        });

        timerReset.addEventListener('click', () => {
            setTimerFn(timerDuration);
        });

        presetBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                presetBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                setTimerFn(parseInt(btn.dataset.time));
            });
        });

        setCustomTimeBtn.addEventListener('click', () => {
            const time = parseInt(customTimeInput.value);
            if (time > 0) {
                presetBtns.forEach(b => b.classList.remove('active'));
                setTimerFn(time);
                customTimeInput.value = '';
            }
        });

        customTimeInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') setCustomTimeBtn.click();
        });

        // ==================== INIT ====================

        // 테스트 데이터 생성 (데이터가 없을 때만)
        function generateTestData() {
            if (data.exercises.length > 0) return; // 이미 데이터가 있으면 스킵

            const exercises = [
                { name: '팔굽혀펴기', color: '#ff6b6b' },
                { name: '윗몸일으키기', color: '#51cf66' },
                { name: '벤치프레스', color: '#339af0' },
                { name: '스쿼트', color: '#cc5de8' }
            ];

            exercises.forEach(ex => {
                data.exercises.push(ex.name);
                data.colors[ex.name] = ex.color;
                data.records[ex.name] = [];
            });

            // 한달치 데이터 생성 (오늘부터 30일 전까지)
            const now = new Date();
            for (let i = 30; i >= 0; i--) {
                const d = new Date(now);
                d.setDate(d.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];

                // 랜덤하게 운동 (70% 확률로 운동함)
                if (Math.random() > 0.3) {
                    // 팔굽혀펴기 (3-5세트)
                    if (Math.random() > 0.3) {
                        const sets = 3 + Math.floor(Math.random() * 3);
                        for (let s = 0; s < sets; s++) {
                            data.records['팔굽혀펴기'].push({
                                d: dateStr,
                                w: 1,
                                r: 15 + Math.floor(Math.random() * 20) // 15-35회
                            });
                        }
                    }

                    // 윗몸일으키기 (3-4세트)
                    if (Math.random() > 0.4) {
                        const sets = 3 + Math.floor(Math.random() * 2);
                        for (let s = 0; s < sets; s++) {
                            data.records['윗몸일으키기'].push({
                                d: dateStr,
                                w: 1,
                                r: 20 + Math.floor(Math.random() * 15) // 20-35회
                            });
                        }
                    }

                    // 벤치프레스 (4-5세트, 점진적 증가)
                    if (Math.random() > 0.4) {
                        const baseWeight = 40 + Math.floor((30 - i) / 5) * 2.5; // 점진적 증가
                        const sets = 4 + Math.floor(Math.random() * 2);
                        for (let s = 0; s < sets; s++) {
                            data.records['벤치프레스'].push({
                                d: dateStr,
                                w: baseWeight + (s < 2 ? 0 : 5), // 마지막 세트들은 +5kg
                                r: 8 + Math.floor(Math.random() * 5) // 8-12회
                            });
                        }
                    }

                    // 스쿼트 (3-4세트)
                    if (Math.random() > 0.4) {
                        const sets = 3 + Math.floor(Math.random() * 2);
                        for (let s = 0; s < sets; s++) {
                            data.records['스쿼트'].push({
                                d: dateStr,
                                w: 1,
                                r: 15 + Math.floor(Math.random() * 10) // 15-25회
                            });
                        }
                    }
                }
            }

            save();
        }

        generateTestData();
        renderMain();
        renderCalendar();
        updateTimerDisplay();
    </script>
</body>
</html>
